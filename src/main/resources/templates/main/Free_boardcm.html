<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ììœ ê²Œì‹œíŒ-ëŒ“ê¸€</title>
    <link rel="stylesheet" href="/css/main/boardcm.css">
    <link rel="stylesheet" href="/css/main/header.css" type="text/css" />
</head>
<body>
<div id="header" class="header_wrap" th:replace="~{main/mainHeader}"></div>


        <h1 class="title-box" th:text="${userPostBoard.title}">ì¶”ì²œ ì˜í•´ì£¼ëŠ” ê±° ê°™ì•„ìš”.</h1>
<div class="separator"></div>
<div class="post-meta-wrapper">
        <div class="post-meta">
            <span class="writer">ì‘ì„±ì: <span th:text="${userPostBoard.user.userId}">ì‘ì„±ìì•„ì´ë””</span></span> |
            <span class="date">ì‘ì„±ì¼: <span th:text="${#temporals.format(userPostBoard.created_at, 'yyyy-MM-dd HH:mm')}">ì‘ì„±ì¼ì</span></span>
        </div>
</div>

    <div class="separator"></div>
    <p th:utext="${userPostBoard.contents}" class="content-box fixed-content"> ì—¬ëŸ¬ ë³´ì¶©ì œë¥¼ ë¨¹ì–´ë´¤ì§€ë§Œ ì†Œí™”ê°€ ì˜ ì•ˆë˜ê°€ì§€ê³ .. ê³ ë¯¼ì´ ë§ì•˜ì–´ìš”ã… ã… 
ì„¤ë¬¸ì§€ ì‘ì„±í•´ì„œ ì €í•œí…Œ ë§ëŠ” ë³´ì¶©ì œë¥¼ í”½í•´ì„œ ì•Œë ¤ì£¼ë‹ˆê¹Œ 1:1 ë§ì¶¤ì¸ ëŠë‚Œ?
ë°›ì•„ì„œ ë¨¹ì–´ë³´ë‹ˆê¹Œ ì „ë³´ë‹¤ ì†Œí™”ë„ ì˜ë˜ê³  ë‹¨ë°±ì§ˆê¹Œì§€ ì±™ê²¨ì„œ
í—¬ìŠ¤ì¸ì¸ ì €í•œí…ŒëŠ” ë„ˆë¬´ë‚˜ ë§Œì¡±ìŠ¤ëŸ¬ìš´ êµ¬ë§¤ì˜€ìŠµë‹ˆë‹¤.!
ë³´ì¶©ì œ ë­ì‚¬ì•¼í• ì§€ ê³ ë¯¼ì´ë¼ë©´ ì„¤ë¬¸ í†µí•´ì„œ êµ¬ë§¤í•˜ëŠ”ê±° ì™„ì „ ì¶”ì²œ!!</p>
    <div class="upload-section">
        <div class="upload-box1">
            <img th:src="@{/user_post_files/{filename}(filename=${userPostBoard.filename})}" alt="Uploaded Image"/>
        </div>
    </div>
    <div class="button-container">
        <span class="like-button" id="like-button">ğŸ‘</span>
        <div th:if="${userPostBoard.user.userId} == ${#authentication.name}">
            <button class="voidbtn">
                <a th:href="@{/main/board_delete(id=${userPostBoard.id})}">ì‚­ì œ</a>
            </button>
            <button class="voidbtn">
                <a th:href="@{/main/free_modify/{id}(id=${userPostBoard.id})}">ìˆ˜ì •</a>
            </button>
        </div>


    </div>
    <div class="separator1"></div>
    <div class="comment-section">
        <h3>ëŒ“ê¸€</h3>
        <div class="comment-input-box">
            <textarea id="comment-box" class="comment-box" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
            <button class="comment-submit-button" id="comment-submit-button" type="button" >ë“±ë¡</button>
        </div>
    </div>

    <!-- ëŒ“ê¸€ ëª©ë¡ -->
<div class="comment-list">
    <div class="comment-item" th:each="comment : ${commentList}"
         th:attr="data-comment-id=${comment.id}">
    <div class="comment-header">
            <span th:text="${comment.created_at}">ì‘ì„± ë‚ ì§œ</span>
        </div>
        <p class="comment-content">ì‘ì„±ì: <span sec:authentication="name">ì‘ì„±ìë²ˆí˜¸</span></p>
        <p class="comment-content" th:text="${comment.contents}">ëŒ“ê¸€ ë‚´ìš©</p>


        <div th:if="${comment.user.userId} == ${#authentication.name}">
            <button class="comment-submit-button">
                <a th:href="@{/main/comments/{id}/edit(id=${comment.id})}">ìˆ˜ì •</a>
            </button>
            <button class="comment-delete-button"
                    th:attr="data-comment-id=${comment.id}, data-post-id=${userPostBoard.id}">
                ì‚­ì œ
            </button>
        </div>


    </div>
</div>


</body>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("comment-submit-button").addEventListener("click", function () {
            console.log("ëŒ“ê¸€ ë“±ë¡ ë²„íŠ¼ í´ë¦­ë¨!"); // ì½˜ì†” í™•ì¸
            submitComment(); // ëŒ“ê¸€ ë“±ë¡ í•¨ìˆ˜ í˜¸ì¶œ
        });
    });




        document.addEventListener("DOMContentLoaded", function () {
            // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë“±ë¡
            document.querySelectorAll(".comment-delete-button").forEach(button => {
                button.addEventListener("click", async function () {
                    const commentId = this.getAttribute("data-comment-id");
                    const postId = this.getAttribute("data-post-id");

                    if (!confirm("ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

                    try {
                        const response = await fetch(`/api/main/Free_boardcm/${postId}/comments/${commentId}`, {
                            method: "DELETE",
                            headers: {
                                "Content-Type": "application/json"
                            }
                        });

                        if (response.ok) {
                            alert("ëŒ“ê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                            location.reload(); // ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ì‚­ì œëœ ëŒ“ê¸€ ë°˜ì˜
                        } else {
                            alert("ëŒ“ê¸€ ì‚­ì œ ì‹¤íŒ¨");
                        }
                    } catch (error) {
                        console.error("ì‚­ì œ ì¤‘ ì˜¤ë¥˜:", error);
                    }
                });
            });
        });
    async function submitComment() {
        console.log("submitComment í•¨ìˆ˜ ì‹¤í–‰ë¨!");

        let postId = [[${userPostBoard.id}]]; // Thymeleafì—ì„œ ê²Œì‹œê¸€ ID ê°€ì ¸ì˜¤ê¸°
        let commentContents = document.querySelector("#comment-box").value;

        if (!commentContents.trim()) {
            alert("ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”!");
            return;
        }

        let requestData = {
            contents: commentContents
        };

        try {
            const response = await fetch(`/main/Free_boardcm/${postId}/comments`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(requestData)
            });

            if (response.ok) {
                alert("ëŒ“ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
                location.reload();
            } else {
                alert("ëŒ“ê¸€ ë“±ë¡ ì‹¤íŒ¨!");
            }
        } catch (error) {
            console.error("ëŒ“ê¸€ ë“±ë¡ ì¤‘ ì˜¤ë¥˜:", error);
        }

    }

</script>


<script src="/js/main/free_boardcm.js"></script>
<script src="/js/main/header.js" defer></script>
</html>